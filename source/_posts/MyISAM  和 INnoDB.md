---
MyISAM  和 INnoDBlayout: myisam
title: MyISAM 和INnoDB 区别
date: 2024-04-29 16:50:45
tags: Mysql
---

# MyISAM  和 INnoDB



InnoDB和MyISAM是MySQL数据库中两种常用的存储引擎。

InnoDB是一种支持事务处理和行级锁定的存储引擎。它是MySQL默认的存储引擎，也被认为是更现代和可靠的选择。InnoDB支持事务的ACID特性（原子性、一致性、隔离性和持久性），这对于需要严格数据完整性和并发控制的应用程序非常重要。

InnoDB还提供了外键约束、并发性能优化、崩溃恢复功能以及多版本并发控制（MVCC），这使得它在高并发读写负载下表现良好。此外，InnoDB使用行级锁定，允许多个事务同时访问不同的行，从而提高了并发性能。

MyISAM是另一种存储引擎，它没有提供像InnoDB那样的事务处理和行级锁定功能。MyISAM更适合于读密集型应用，例如只进行插入和查询操作的应用。它具有较低的内存和磁盘空间开销，但在并发写入场景下性能可能会受到影响。

MyISAM支持全文索引和压缩表格，这在某些特定的应用场景下很有用。此外，MyISAM表格的维护和修复也相对简单。

总结来说，如果你需要支持事务处理、并发控制和数据完整性，或者有高并发读写负载的应用，那么InnoDB是更好的选择。如果你有读密集型的应用，或者对全文索引和压缩表格有特殊需求，那么MyISAM可能更适合。

![image-20240429170628775](MyISAM%20%20%E5%92%8C%20INnoDB/image-20240429170628775-17143815936841.png)

**1.MyISAM**

![image-20240429170737293](MyISAM%20%20%E5%92%8C%20INnoDB/image-20240429170737293.png)

从这张图可以发现，这个存储引擎通过MYI的B+树结构来查找记录页，再根据记录页查找记录。并且支持全文索引、B树索引和数据压缩。

支持数据的类型也有三种：

（1）静态固定长度表

这种方式的优点在于存储速度非常快，容易发生缓存，而且表发生损坏后也容易修复。缺点是占空间。这也是默认的存储格式。

（2）动态可变长表

优点是节省空间，但是一旦出错恢复起来比较麻烦。

（3）压缩表

上面说到支持数据压缩，说明肯定也支持这个格式。在数据文件发生错误时候，可以使用check table工具来检查，而且还可以使用repair table工具来恢复。

有一个重要的特点那就是不支持事务，但是这也意味着他的存储速度更快，如果你的读写操作允许有错误数据的话，只是追求速度，可以选择这个存储引擎。

使用这个存储引擎，每个MyISAM在磁盘上存储成三个文件。

（1）frm文件：存储表的定义数据

（2）MYD文件：存放表具体记录的数据

（3）MYI文件：存储索引

frm和MYI可以存放在不同的目录下。MYI文件用来存储索引，但仅保存记录所在页的指针，索引的结构是B+树结构。下面这张图就是MYI文件保存的机制：

**2. INnoDB**

InnoDB是默认的数据库存储引擎，他的主要特点有：

（1）可以通过自动增长列，方法是auto_increment。

（2）支持事务。默认的事务隔离级别为可重复度，通过MVCC（并发版本控制）来实现的。

（3）使用的锁粒度为行级锁，可以支持更高的并发；

（4）支持外键约束；外键约束其实降低了表的查询速度，但是增加了表之间的耦合度。

（5）配合一些热备工具可以支持在线热备份；

（6）在InnoDB中存在着缓冲管理，通过缓冲池，将索引和数据全部缓存起来，加快查询的速度；

（7）对于InnoDB类型的表，其数据的物理组织形式是聚簇表。所有的数据按照主键来组织。数据和索引放在一块，都位于B+数的叶子节点上；

当然InnoDB的存储表和索引也有下面两种形式：

（1）使用共享表空间存储：所有的表和索引存放在同一个表空间中。

（2）使用多表空间存储：表结构放在frm文件，数据和索引放在IBD文件中。分区表的话，每个分区对应单独的IBD文件，分区表的定义可以查看我的其他文章。使用分区表的好处在于提升查询效率。

对于InnoDB来说，最大的特点在于支持事务。但是这是以损失效率来换取的。



### 附录

#### 一、哈希索引

哈希索引（Hash Index）是一种在数据库中用于快速查找数据的索引结构。它基于哈希函数（Hash Function）将关键字映射到索引中的槽位，从而实现高效的数据检索。

哈希索引的工作原理如下：

1. 哈希函数：哈希函数是关键的组成部分，它接收输入的关键字并生成一个固定大小的哈希值。哈希值是一个在索引中用于定位槽位的地址。
2. 槽位：哈希索引由一个固定大小的槽位数组构成。每个槽位存储一个指向数据行的指针或者实际的数据。
3. 哈希冲突：由于哈希函数的输出空间通常比输入空间小得多，可能会出现不同的关键字生成相同的哈希值。这种情况被称为哈希冲突。常见的解决哈希冲突的方法有开放定址法、链地址法等。
4. 查找过程：当进行数据检索时，通过哈希函数计算关键字的哈希值，并使用该哈希值定位到对应的槽位。如果哈希冲突发生，可以使用冲突解决方法找到正确的数据行。

哈希索引的优点包括：

- 快速查找：哈希索引通过哈希函数直接定位到存储数据的位置，因此在理想情况下，查找时间是常数级别的，非常高效。
- 索引尺寸小：相对于其他索引结构，哈希索引的存储空间通常较小，这是因为哈希函数将关键字映射到固定大小的槽位数组中。

然而，哈希索引也有一些限制和适用场景：

- 唯一性限制：哈希索引要求关键字具有唯一性，因为不同的关键字生成相同的哈希值会导致哈希冲突。如果存在重复的关键字，需要使用冲突解决方法。
- 不支持范围查询：由于哈希函数的特性，哈希索引无法支持范围查询，例如大于、小于等条件。
- 冲突解决开销：当哈希冲突发生时，需要进行冲突解决，这会增加一定的开销。

总结来说，哈希索引是一种高效的索引结构，适用于需要快速查找的场景，但对唯一性要求高且不支持范围查询。在实际应用中，可以根据具体需求选择合适的索引结构来优化数据库的性能。

## 二、刷新邻接页

刷新邻接页（Flush Neighbor Page）是InnoDB存储引擎中的一项性能优化机制，用于减少IO操作和提高查询的效率。

在InnoDB中，数据文件由多个页（Page）组成，每个页的大小一般为16KB。邻接页（Neighbor Page）是指在执行查询时，与查询结果相关的附近的页。当数据库需要从磁盘读取某个页时，InnoDB会尽可能将其附近的邻接页也一并加载到内存中，以提高访问效率。

而刷新邻接页的机制则是在某个页被修改后，将其邻接页标记为"脏页"（Dirty Page），表示它们的内容不再是最新的。当其他查询需要访问这些邻接页时，InnoDB会检测到它们是脏页，并将其从内存中写回到磁盘，以保证数据的一致性。

刷新邻接页的好处在于减少了对磁盘的频繁访问。通过将邻接页一起写回磁盘，可以减少单个页的写入次数，避免了频繁的磁盘IO操作。这对于提高查询的响应速度和整体性能非常重要，特别是在高并发的查询场景下。

需要注意的是，刷新邻接页并不是实时进行的，而是通过一定的策略和机制来控制。例如，InnoDB可以根据页的修改频率和重要性来优化刷新邻接页的顺序和时机，以提高效率。

总结来说，刷新邻接页是InnoDB存储引擎中的一项性能优化机制，它将被修改的页及其邻接页标记为脏页，并在合适的时机将其写回磁盘，以减少IO操作，提高查询的效率和整体性能。

