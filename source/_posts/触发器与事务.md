---
title: 触发器与事务
typora-root-url: 触发器与事务
date: 2024-04-29 17:17:17
tags:
---

#  1. 数据库触发器

数据库触发器（Database Triggers）是一种在特定事件发生时自动执行的数据库操作。触发器可以在数据插入、更新或删除等操作之前或之后触发，用于实现数据的约束、验证、日志记录等功能。在MySQL中，可以使用CREATE TRIGGER语句来创建触发器。以下是一个创建触发器的示例：

```sql
CREATE TRIGGER trigger_name 
BEFORE INSERT ON table_name FOR EACH ROW BEGIN 
-- 触发器执行的操作 
END;
```

上述示例创建了一个在插入数据到table_name表之前触发的触发器。可以根据需求选择BEFORE、AFTER关键字来指定触发器的触发时机。FOR EACH ROW表示每一行数据都会触发触发器。

在BEGIN和END之间，可以编写触发器执行的操作，例如插入、更新、删除数据，或者进行数据验证、约束等操作。可以使用NEW关键字引用插入或更新的新数据，OLD关键字引用被更新或删除的旧数据。以下是一个简单的触发器示例，用于在插入数据到orders表之前自动更新订单创建时间：

```mysql
CREATE TRIGGER update_create_time 
BEFORE INSERT ON orders 
FOR EACH ROW 
BEGIN 
SET NEW.create_time = NOW(); END;
```

数据库事务（Database Transaction）是一组数据库操作的集合，这些操作要么全部成功执行，要么全部回滚，保证了数据库的一致性和完整性。

#  2 . 数据库事务

事务具有以下四个特性，通常被称为ACID特性：

**1.原子性（Atomicity）**：事务中的所有操作要么全部成功执行，要么全部回滚。如果任何一个操作失败，整个事务将被回滚到初始状态，不会对数据库产生影响。

**2.一致性（Consistency）**：事务在开始和结束时，数据库的状态必须保持一致。事务执行的操作必须满足数据库定义的约束、触发器和规则，以确保数据的完整性。

**3.隔离性（Isolation）：**事务的执行应该与其他事务隔离开来，每个事务都应该感知不到其他并发事务的存在。隔离级别可以控制事务之间的相互影响程度，包括读取未提交数据、读取已提交数据、可重复读、串行化等级别。

**4.持久性（Durability）：**一旦事务提交，其结果应该永久保存在数据库中，并且不能因为系统故障或崩溃而丢失。数据库系统通过将事务日志写入磁盘来实现持久性。

在使用数据库事务时，通常遵循以下步骤：

开启事务：通过BEGIN、START TRANSACTION等语句开始一个新的事务。

执行操作：执行一系列数据库操作，包括插入、更新、删除等。

提交或回滚：如果所有操作都成功执行，使用COMMIT语句提交事务。如果发生错误或不符合条件，使用ROLLBACK语句回滚事务。

事务可以在应用程序中进行控制，也可以使用存储过程或触发器等数据库内部机制来实现。需要根据具体的业务需求和数据库系统的支持来选择适当的事务管理方式。同时，也需要注意事务的并发性能和锁定问题，以避免长时间的事务阻塞其他操作。
